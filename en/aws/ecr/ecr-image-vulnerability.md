# AWS / ECR / ECR Image Vulnerability

## Quick Info

| | |
|-|-|
| **Plugin Title** | Amazon ECR Scan on Push |
| **Cloud** | AWS |
| **Category** | ECR |
| **Description** | Ensures Amazon ECR container images are automatically scanned for security vulnerabilities after being pushed to a repository |
| **More Info** | Scan on Push for Amazon ECR is an automated vulnerability assessment feature that helps improve the security of ECR container images by scanning them for OS vulnerabilities. |
| **AWS Link** | https://docs.aws.amazon.com/AmazonECR/latest/userguide/image-scanning.html |
| **Recommended Action** | Enable "Scan on Push" for your Amazon ECR repositories. |

## Detailed Remediation Steps
1. Log in to the AWS Management Console.
2. Select the "Services" option and search for ECR (Elastic Container Registry).
3. In the left navigation panel, select "Repositories" under "Private registry".
4. Select the repository that needs to have "Scan on Push" enabled by clicking on the repository name.
5. On the repository details page, click on the "Edit" button at the top right corner.
6. Scroll down to the "Image scan settings" section.
7. Under "Scan type", ensure the scanning feature is configured:
   a. Select "Basic scanning" for OS vulnerability scanning (recommended for most use cases).
   b. Alternatively, select "Enhanced scanning" for both OS and programming language package vulnerability scanning (requires Amazon Inspector integration).
8. Check the box for "Scan on push" to enable automatic scanning of images when they are pushed to the repository.
9. Click on the "Save" button at the bottom of the page to apply the changes.
10. To verify the configuration, navigate back to the "Repositories" list and confirm that the "Image scanning" column now shows "Scan on push" is enabled for the repository.
11. To test the scanning functionality, push a new image to the repository using Docker commands. The scan will automatically start upon image push:
   a. Authenticate to ECR: `aws ecr get-login-password --region <region> | docker login --username AWS --password-stdin <account-id>.dkr.ecr.<region>.amazonaws.com`
   b. Tag your image: `docker tag <image-name>:<tag> <repository-uri>:<tag>`
   c. Push the image: `docker push <repository-uri>:<tag>`
12. After the scan completes (typically within a few minutes), click on the repository name and select the image to view its scan findings.
13. Click on the "Image scan findings" tab to view vulnerability details:
   a. Review the severity levels: Critical, High, Medium, Low, and Informational.
   b. Examine specific CVE (Common Vulnerabilities and Exposures) details for each finding.
   c. Note the affected packages and recommended remediation actions.
14. Repeat steps 4 - 9 to enable "Scan on Push" for all other ECR repositories in your account.
15. For bulk enablement across multiple repositories, you can use the AWS CLI command:
   `aws ecr put-image-scanning-configuration --repository-name <repository-name> --image-scanning-configuration scanOnPush=true --region <region>`
